pivot_df = df.pivot(index='DATE', columns='CLIENT_NAME', values='INT_RATE')

import numpy as np
quarterly_flag = pd.DataFrame(index=pivot_df.index[2:], columns=pivot_df.columns)

for client in pivot_df.columns:
    series = pivot_df[client]
    for i in range(2, len(series)):
        prev_2 = series.iloc[i-2:i]  # two months before
        curr = series.iloc[i]        # current month
        if (
            (prev_2 < 0.001).all() and  # near-zero past 2 months
            (curr > 0.005)              # spike in current month
        ):
            quarterly_flag.at[series.index[i], client] = 1
        else:
            quarterly_flag.at[series.index[i], client] = 0

quarterly_counts = quarterly_flag.sum()
quarterly_clients = quarterly_counts[quarterly_counts >= 3].index.tolist()  # adjust threshold as needed

import matplotlib.pyplot as plt

for client in quarterly_clients:
    pivot_df[client].plot(title=client)
    plt.show()