import pandas as pd
import matplotlib.pyplot as plt

# Load results
cutoff_results = pd.read_csv("segmentation_cutoff_comparison.csv")

# Convert cutoff column to string for easier plotting
cutoff_results['cutoff_str'] = cutoff_results['cutoff'].apply(lambda x: f"≤{int(x/1_000_000)}MM")

# Plot chi-squared comparison across windows for each cutoff
plt.figure(figsize=(12, 6))

# Plot line per cutoff
for cutoff in sorted(cutoff_results['cutoff'].unique()):
    subset = cutoff_results[cutoff_results['cutoff'] == cutoff]
    plt.plot(subset['window'], subset['chi2_stat'], marker='o', label=f'Cutoff ≤{int(cutoff/1_000_000)}MM')

plt.title('Chi-Squared Comparison Across Commitment Cutoffs')
plt.xlabel('Rolling Window')
plt.ylabel('Chi-Squared Statistic')
plt.legend(title='Commitment Cutoff')
plt.grid(True)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# Optional: P-value plot
plt.figure(figsize=(12, 6))
for cutoff in sorted(cutoff_results['cutoff'].unique()):
    subset = cutoff_results[cutoff_results['cutoff'] == cutoff]
    plt.plot(subset['window'], subset['p_value'], marker='s', label=f'Cutoff ≤{int(cutoff/1_000_000)}MM')

plt.axhline(0.05, color='red', linestyle='--', label='Significance Threshold (0.05)')
plt.title('P-Value Comparison Across Commitment Cutoffs')
plt.xlabel('Rolling Window')
plt.ylabel('P-Value')
plt.legend(title='Commitment Cutoff')
plt.grid(True)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()