import pandas as pd
from google.cloud import bigquery
from google.oauth2 import service_account

# Define your Google BigQuery credentials (Use your own JSON key file)
credentials = service_account.Credentials.from_service_account_file("your_service_account.json")

# Initialize BigQuery client
client = bigquery.Client(credentials=credentials, project=credentials.project_id)

# Define the month-year pairs
month_year_pairs = [
    ("01", "2024"),  # January 2024
    ("02", "2024"),  # February 2024
    ("03", "2024")   # March 2024
    # Add more as needed
]

# Base SQL query with placeholders
base_query = """
SELECT * 
FROM `your_project.your_dataset.your_table`
WHERE month = '{month_placeholder}' AND year = '{year_placeholder}'
"""

# Initialize an empty DataFrame to store the final result
final_df = pd.DataFrame()

# Loop through month-year pairs
for month, year in month_year_pairs:
    # Replace placeholders with actual month and year
    query = base_query.replace("{month_placeholder}", month).replace("{year_placeholder}", year)
    
    # Run the query
    df = client.query(query).to_dataframe()

    # Print the shape of the current month's DataFrame
    print(f"Shape of DataFrame for {month}-{year}: {df.shape}")

    # Append the new data to final_df
    final_df = pd.concat([final_df, df], ignore_index=True)

    # Print the cumulative DataFrame shape
    print(f"Shape of cumulative DataFrame: {final_df.shape}")

# Output final DataFrame shape
print(f"Final DataFrame shape after all iterations: {final_df.shape}")



**we can projects 53 granular non-interest income and expense line items**  

- **Quantitative models**  
  - Recalibrate models by incorporating most recent data observations, and redevelop certain model using the Variable Selection Process.  
  - Run quantitative models utilizing macroeconomic input, which produce projections in the various scenarios using the relationship between statistically significant & intuitive macroeconomic variables and a particular line item.  
  - Consider the need for model overlay and implement, if necessary, to account for model weaknesses or recent / known changes to the respective line of business.  

- **Management Estimates**  
  - Line items are projected using a non-modeled / management estimate process when a model was attempted but not used after undergoing thorough review & testing and/or the line item has a known, logical relationship with an internal driver.  
  - Results across scenarios are compared to ensure the projections between scenarios are appropriately differentiated and are logical given scenario conditions.  
  - Projections are also evaluated against business drivers to ensure consistency between financial statements.  

- Subject matter expert projections are those projections that have more involved projection methodologies and are integrated into the Non Interest projections. Line items include: **CRE Mortgage Servicing Rights Valuation, FDIC Expense and Operational RISK.**  

- **Review and Challenge** is conducted at multiple levels of the organization and participants include:  
  - LOB Subject Matter Experts  
  - LOB CFO  
  - Senior Management  

---


