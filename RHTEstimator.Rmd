import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from ipywidgets import interact, widgets

# Convert SNAPSHOT_DT to datetime
df['SNAPSHOT_DT'] = pd.to_datetime(df['SNAPSHOT_DT'])

# Extract year
df['YEAR'] = df['SNAPSHOT_DT'].dt.year

# Unique filter options
year_options = sorted(df['YEAR'].dropna().unique())
code_options = df['CR_OR_DB_CODE'].dropna().unique()

@interact(year=widgets.Dropdown(options=year_options, description='Year'),
          code=widgets.Dropdown(options=code_options, description='Type'))
def plot_distribution(year, code):
    # Filter
    filtered = df[(df['YEAR'] == year) & (df['CR_OR_DB_CODE'] == code)]
    
    # Avg transaction amount per BORROWER_NAME
    avg_amt = filtered.groupby('BORROWER_NAME')['TRAN_AMT'].mean().reset_index()
    
    # Plot
    plt.figure(figsize=(10,6))
    sns.histplot(avg_amt['TRAN_AMT'], bins=30, kde=True)
    plt.title(f'Distribution of Avg Transaction Amount ({code}, {year})')
    plt.xlabel('Average Transaction Amount')
    plt.ylabel('Count of Borrowers')
    plt.grid(True)
    plt.tight_layout()
    plt.show()