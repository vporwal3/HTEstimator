no---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(plm)

# -----------------------------------------------------------
# 1) Read in your data from a .dat file
# -----------------------------------------------------------
# Example: data file "mydata.dat" with columns:
#   id, t, lwage, wks, union, exp, exp2, south, smsa, fem, blk, ed
# Adjust the path, separators, and other arguments as needed.
df_r <- read.table("/psidextract.dat", header = TRUE)

# -----------------------------------------------------------
# 2) Convert to a panel-data frame
# -----------------------------------------------------------
# index = c("id","t") indicates "id" is the individual, "t" is the time dimension
df_r <- plm.data(df_r, index = c("id", "t"))



import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.linear_model import LogisticRegression

def plot_feature_analysis(X, y, feature_name):
    """
    Plots log-odds vs. feature values along with feature distribution plots.
    
    Includes:
        1. Log-Odds Plot (Actual vs. Predicted)
        2. Box Plot of the Feature
        3. Violin Plot of the Feature
        4. Density Plot (KDE) of the Feature
    
    Parameters:
        X (pd.DataFrame or np.array): Single feature values
        y (pd.Series or np.array): Binary target values (0/1)
        feature_name (str): Name of the feature to display on x-axis
    """

    # Reshape if necessary
    if isinstance(X, pd.DataFrame):
        X = X[feature_name].values.reshape(-1, 1)
    else:
        X = X.reshape(-1, 1)

    # Fit Logistic Regression Model
    model = LogisticRegression(class_weight="balanced", solver="liblinear")
    model.fit(X, y)

    # Get predicted log-odds
    log_odds_pred = model.decision_function(X)

    # âœ… Fix: Ensure bin edges are unique to avoid ValueError
    bins = np.unique(np.percentile(X, np.linspace(0, 100, 10)))  # Removes duplicate bin edges

    # Bin feature values to estimate actual log-odds
    df_bin = pd.DataFrame({'Feature': X.flatten(), 'Target': y})
    df_bin['Bins'] = pd.cut(df_bin['Feature'], bins=bins, include_lowest=True, duplicates='drop')

    # Compute actual log-odds from empirical data
    grouped = df_bin.groupby('Bins')['Target'].agg(['sum', 'count'])
    grouped['Empirical Log-Odds'] = np.log((grouped['sum'] + 1) / (grouped['count'] - grouped['sum'] + 1))  # Avoid div by zero

    # Midpoints of bins for plotting
    bin_midpoints = [(interval.left + interval.right) / 2 for interval in grouped.index]

    # Create a 2x2 plot grid
    fig, axes = plt.subplots(2, 2, figsize=(12, 10))

    # ðŸ”¹ 1. Log-Odds Plot (Top-Left)
    axes[0, 0].scatter(bin_midpoints, grouped['Empirical Log-Odds'], color='blue', label="Actual Log-Odds", alpha=0.7)
    sorted_indices = np.argsort(X.flatten())
    axes[0, 0].plot(X.flatten()[sorted_indices], log_odds_pred[sorted_indices], color='goldenrod', linewidth=2, label="Predicted Log-Odds")
    axes[0, 0].set_xlabel(feature_name)
    axes[0, 0].set_ylabel("Log Odds")
    axes[0, 0].set_title(f"Log-Odds vs. {feature_name}")
    axes[0, 0].legend()
    axes[0, 0].grid(True)

    # ðŸ”¹ 2. Box Plot (Top-Right)
    sns.boxplot(x=X.flatten(), ax=axes[0, 1], color="lightblue")
    axes[0, 1].set_xlabel(feature_name)
    axes[0, 1].set_title(f"Box Plot of {feature_name}")

    # ðŸ”¹ 3. Violin Plot (Bottom-Left)
    sns.violinplot(x=X.flatten(), ax=axes[1, 0], color="lightcoral")
    axes[1, 0].set_xlabel(feature_name)
    axes[1, 0].set_title(f"Violin Plot of {feature_name}")

    # ðŸ”¹ 4. Density Plot (KDE) (Bottom-Right)
    sns.kdeplot(X.flatten(), ax=axes[1, 1], fill=True, color="green", alpha=0.5)
    axes[1, 1].set_xlabel(feature_name)
    axes[1, 1].set_title(f"Density Plot (KDE) of {feature_name}")

    # âœ… Adjust layout
    plt.tight_layout()
    plt.show()