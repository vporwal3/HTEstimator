Hi Jordan,

I hope you’re doing well. Gang may have already mentioned this, but I just wanted to let you know that I’ve been temporarily reassigned to another project focused on the Commercial C&I default model through September.

I wanted to check in and see if there’s someone who will be taking over my line items in the meantime, or if there’s a plan in place for how we’d like to handle them during this period.

Please let me know how you’d like to proceed. Happy to assist with the transition as needed.


import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from ipywidgets import interact, widgets

# --- Data Preprocessing ---
df['SNAPSHOT_DT'] = pd.to_datetime(df['SNAPSHOT_DT'])
df['YEAR'] = df['SNAPSHOT_DT'].dt.year
df['MONTH'] = df['SNAPSHOT_DT'].dt.month
df['QUARTER'] = df['SNAPSHOT_DT'].dt.to_period('Q')

# Define pandemic era
def classify_pandemic_era(date):
    quarter = date.to_period('Q')
    if quarter >= pd.Period('2018Q1') and quarter <= pd.Period('2019Q4'):
        return 'Pre-Pandemic'
    elif quarter >= pd.Period('2020Q1') and quarter <= pd.Period('2022Q4'):
        return 'Pandemic'
    elif quarter >= pd.Period('2023Q1'):
        return 'Post-Pandemic'
    else:
        return 'Other'

df['PANDEMIC_ERA'] = df['SNAPSHOT_DT'].apply(classify_pandemic_era)

# --- Filter Dropdowns ---
year_options = sorted(df['YEAR'].dropna().unique())
category_options = ['All'] + sorted(df['HIGH_LVL_CATEGORY_DESC'].dropna().unique())

# --- Plot 1: Avg Transaction Amount per Borrower ---
@interact(
    year=widgets.Dropdown(options=year_options, description='Year'),
    category=widgets.Dropdown(options=category_options, description='Category')
)
def plot_avg_tran_amt_by_category(year, category):
    filtered = df[df['YEAR'] == year]
    if category != 'All':
        filtered = filtered[filtered['HIGH_LVL_CATEGORY_DESC'] == category]

    fig, axes = plt.subplots(1, 2, figsize=(14,6), sharey=True)
    for i, tx_type in enumerate(['Credit', 'Debit']):
        sub_df = filtered[filtered['CR_OR_DB_CODE'] == tx_type]
        avg_amt = sub_df.groupby('BORROWER_NAME')['TRAN_AMT'].mean().reset_index()

        sns.histplot(avg_amt['TRAN_AMT'], bins=30, kde=True, ax=axes[i])
        axes[i].set_title(f'{tx_type} - Avg Transaction Amount ({year})')
        axes[i].set_xlabel('Avg Transaction Amount')
        axes[i].set_ylabel('Count of Borrowers')
        axes[i].grid(True)

    plt.tight_layout()
    plt.show()

# --- Plot 2: Avg Monthly Transaction Count per Borrower ---
@interact(
    year=widgets.Dropdown(options=year_options, description='Year'),
    category=widgets.Dropdown(options=category_options, description='Category')
)
def plot_avg_txn_count_by_category(year, category):
    filtered = df[df['YEAR'] == year]
    if category != 'All':
        filtered = filtered[filtered['HIGH_LVL_CATEGORY_DESC'] == category]

    months_in_year = filtered['MONTH'].nunique()
    fig, axes = plt.subplots(1, 2, figsize=(14,6), sharey=True)

    for i, tx_type in enumerate(['Credit', 'Debit']):
        sub_df = filtered[filtered['CR_OR_DB_CODE'] == tx_type]
        txn_count = sub_df.groupby('BORROWER_NAME').size().reset_index(name='TXN_COUNT')
        txn_count['TXN_PER_MONTH'] = txn_count['TXN_COUNT'] / months_in_year

        sns.histplot(txn_count['TXN_PER_MONTH'], bins=30, kde=True, ax=axes[i])
        axes[i].set_title(f'{tx_type} - Avg Monthly Transactions ({year})')
        axes[i].set_xlabel('Avg Monthly Transactions')
        axes[i].set_ylabel('Number of Borrowers')
        axes[i].grid(True)

    plt.tight_layout()
    plt.show()

# --- Plot 3: Borrower-Level Transaction Amounts by Pandemic Era ---
borrower_era_stats = df.groupby(['BORROWER_NAME', 'PANDEMIC_ERA']).agg(
    txn_count=('TRAN_AMT', 'count'),
    avg_amt=('TRAN_AMT', 'mean'),
    total_amt=('TRAN_AMT', 'sum')
).reset_index()

plt.figure(figsize=(10,6))
sns.violinplot(data=borrower_era_stats, x='PANDEMIC_ERA', y='avg_amt', inner='box')
plt.title('Avg Transaction Amount per Borrower Across Pandemic Eras')
plt.xlabel('Pandemic Era')
plt.ylabel('Avg Transaction Amount')
plt.grid(True)
plt.tight_layout()
plt.show()

# --- Optional: Summary Table ---
summary = df.groupby('PANDEMIC_ERA').agg(
    total_transactions=('TRAN_AMT', 'count'),
    total_amount=('TRAN_AMT', 'sum'),
    avg_transaction_amt=('TRAN_AMT', 'mean'),
    unique_borrowers=('BORROWER_NAME', 'nunique')
).reset_index()

print(summary)